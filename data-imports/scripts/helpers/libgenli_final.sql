# Used this to generate this list: SELECT Concat('DROP TRIGGER ', Trigger_Name, ';') FROM  information_schema.TRIGGERS WHERE TRIGGER_SCHEMA = 'libgen_new';
# (from https://stackoverflow.com/a/30339930)
DROP TRIGGER libgen_new.authors_before_ins_tr;
DROP TRIGGER libgen_new.authors_add_descr_before_ins_tr;
DROP TRIGGER libgen_new.authors_add_descr_before_upd_tr;
DROP TRIGGER libgen_new.authors_add_descr_before_del_tr1;
DROP TRIGGER libgen_new.editions_before_ins_tr1;
DROP TRIGGER libgen_new.editions_before_upd_tr1;
DROP TRIGGER libgen_new.editions_before_del_tr1;
DROP TRIGGER libgen_new.editions_add_descr_before_ins_tr;
DROP TRIGGER libgen_new.editions_add_descr_after_ins_tr;
DROP TRIGGER libgen_new.editions_add_descr_before_upd_tr;
DROP TRIGGER libgen_new.editions_add_descr_after_upd_tr;
DROP TRIGGER libgen_new.editions_add_descr_before_del_tr;
DROP TRIGGER libgen_new.editions_add_descr_after_del_tr;
DROP TRIGGER libgen_new.editions_to_files_before_ins_tr;
DROP TRIGGER libgen_new.editions_to_files_before_upd_tr;
DROP TRIGGER libgen_new.editions_to_files_before_del_tr;
DROP TRIGGER libgen_new.files_before_ins_tr;
DROP TRIGGER libgen_new.files_before_upd_tr;
DROP TRIGGER libgen_new.files_before_del_tr;
DROP TRIGGER libgen_new.files_add_descr_before_ins_tr;
DROP TRIGGER libgen_new.files_add_descr_before_upd_tr;
DROP TRIGGER libgen_new.files_add_descr_before_del_tr1;
DROP TRIGGER libgen_new.publisher_before_ins_tr;
DROP TRIGGER libgen_new.publisher_before_upd_tr;
DROP TRIGGER libgen_new.publisher_before_del_tr;
DROP TRIGGER libgen_new.publisher_add_descr_before_ins_tr;
DROP TRIGGER libgen_new.publisher_add_descr_before_upd_tr;
DROP TRIGGER libgen_new.publisher_add_descr_before_del_tr;
DROP TRIGGER libgen_new.series_before_ins_tr;
DROP TRIGGER libgen_new.series_before_upd_tr;
DROP TRIGGER libgen_new.series_before_del_tr;
DROP TRIGGER libgen_new.series_add_descr_before_ins_tr;
DROP TRIGGER libgen_new.series_add_descr_after_ins_tr;
DROP TRIGGER libgen_new.series_add_descr_before_upd_tr;
DROP TRIGGER libgen_new.series_add_descr_after_upd_tr;
DROP TRIGGER libgen_new.series_add_descr_before_del_tr;
DROP TRIGGER libgen_new.series_add_descr_after_del_tr;
DROP TRIGGER libgen_new.works_before_ins_tr;
DROP TRIGGER libgen_new.works_before_upd_tr;
DROP TRIGGER libgen_new.works_before_del_tr;
DROP TRIGGER libgen_new.works_add_descr_before_ins_tr;
DROP TRIGGER libgen_new.works_add_descr_before_upd_tr;
DROP TRIGGER libgen_new.works_add_descr_before_del_tr;
DROP TRIGGER libgen_new.works_to_editions_before_ins_tr;
DROP TRIGGER libgen_new.works_to_editions_before_upd_tr;
DROP TRIGGER libgen_new.works_to_editions_before_del_tr;

# Double-check that the new tables indeed exist, before we start dropping a bunch of existing tables.
SELECT * FROM libgen_new.elem_descr LIMIT 1;
SELECT * FROM libgen_new.files LIMIT 1;
SELECT * FROM libgen_new.editions LIMIT 1;
SELECT * FROM libgen_new.editions_to_files LIMIT 1;
SELECT * FROM libgen_new.editions_add_descr LIMIT 1;
SELECT * FROM libgen_new.files_add_descr LIMIT 1;
SELECT * FROM libgen_new.series LIMIT 1;
SELECT * FROM libgen_new.series_add_descr LIMIT 1;
SELECT * FROM libgen_new.publishers LIMIT 1;
DROP TABLE IF EXISTS allthethings.libgenli_elem_descr;
DROP TABLE IF EXISTS allthethings.libgenli_files;
DROP TABLE IF EXISTS allthethings.libgenli_editions;
DROP TABLE IF EXISTS allthethings.libgenli_editions_to_files;
DROP TABLE IF EXISTS allthethings.libgenli_editions_add_descr;
DROP TABLE IF EXISTS allthethings.libgenli_files_add_descr;
DROP TABLE IF EXISTS allthethings.libgenli_series;
DROP TABLE IF EXISTS allthethings.libgenli_series_add_descr;
DROP TABLE IF EXISTS allthethings.libgenli_publishers;

ALTER TABLE libgen_new.elem_descr RENAME allthethings.libgenli_elem_descr;
ALTER TABLE libgen_new.files RENAME allthethings.libgenli_files;
ALTER TABLE libgen_new.editions RENAME allthethings.libgenli_editions;
ALTER TABLE libgen_new.editions_to_files RENAME allthethings.libgenli_editions_to_files;
ALTER TABLE libgen_new.editions_add_descr RENAME allthethings.libgenli_editions_add_descr;
ALTER TABLE libgen_new.files_add_descr RENAME allthethings.libgenli_files_add_descr;
ALTER TABLE libgen_new.series RENAME allthethings.libgenli_series;
ALTER TABLE libgen_new.series_add_descr RENAME allthethings.libgenli_series_add_descr;
ALTER TABLE libgen_new.publishers RENAME allthethings.libgenli_publishers;

SET SESSION sql_mode = 'NO_ENGINE_SUBSTITUTION';
ALTER TABLE libgenli_editions DROP INDEX `YEAR`, DROP INDEX `N_YEAR`, DROP INDEX `MONTH`, DROP INDEX `MONTH_END`, DROP INDEX `VISIBLE`, DROP INDEX `LG_TOP`, DROP INDEX `TYPE`, DROP INDEX `COMMENT`, DROP INDEX `S_ID`, DROP INDEX `DOI`, DROP INDEX `ISSUE`, DROP INDEX `DAY`, DROP INDEX `TIME`, DROP INDEX `TIMELM`;
ALTER TABLE libgenli_editions_add_descr DROP INDEX `TIME`, DROP INDEX `VAL3`, DROP INDEX `VAL`, DROP INDEX `VAL2`, DROP INDEX `VAL1`, DROP INDEX `VAL_ID`, DROP INDEX `VAL_UNIQ`, DROP INDEX `KEY`;
ALTER TABLE libgenli_editions_to_files DROP INDEX `TIME`, DROP INDEX `FID`; -- f_id is already covered by `IDS`.
ALTER TABLE libgenli_elem_descr DROP INDEX `key`;
ALTER TABLE libgenli_files DROP INDEX `md5_2`, DROP INDEX `MAGZID`, DROP INDEX `COMICSID`, DROP INDEX `LGTOPIC`, DROP INDEX `FICID`, DROP INDEX `FICTRID`, DROP INDEX `SMID`, DROP INDEX `STDID`, DROP INDEX `LGID`, DROP INDEX `FSIZE`, DROP INDEX `SMPATH`, DROP INDEX `TIME`, DROP INDEX `TIMELM`;
ALTER TABLE libgenli_files_add_descr DROP INDEX `TIME`, DROP INDEX `VAL`, DROP INDEX `KEY`;
ALTER TABLE libgenli_publishers DROP INDEX `TIME`, DROP INDEX `COM`, DROP INDEX `FULLTEXT`;
ALTER TABLE libgenli_series DROP INDEX `LG_TOP`, DROP INDEX `TIME`, DROP INDEX `TYPE`, DROP INDEX `VISIBLE`, DROP INDEX `COMMENT`, DROP INDEX `VAL_FULLTEXT`;
ALTER TABLE libgenli_series_add_descr DROP INDEX `TIME`, DROP INDEX `VAL`, DROP INDEX `VAL1`, DROP INDEX `VAL2`, DROP INDEX `VAL3`;

DROP DATABASE libgen_new;
